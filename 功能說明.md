# 記帳小工具 - 功能說明文檔

## 📋 系統概述

這是一個基於 AI 智能分析的月收支記帳工具，能夠自動從自然語言文字中識別收入和支出項目，並生成完整的財務分析報表。系統採用 Next.js 16 框架開發，使用 React 19、TypeScript、Tailwind CSS 等現代技術棧。

---

## 🎯 核心功能

### 1. AI 智能文字分析

**功能描述：**
- 用戶可以輸入自然語言描述的收支資訊
- 系統使用 OpenAI GPT-4o 模型自動分析文字內容
- AI 會自動識別並分類收入與支出項目
- 支援智能推測缺失資訊（如日期、數量等）
- 分析過程模擬 10 秒讀取效果，提供視覺化進度顯示

**技術實現：**
- 使用 Vercel AI SDK 的 `generateObject` 功能
- 使用 Zod schema 驗證和結構化輸出
- 支援的收入分類：生意收入、生活收入
- 支援的支出分類：生意支出、生活支出

**輸入範例：**
```
今天是2024年1月15日，天氣晴朗，咖啡店來了80位客人。
賣出咖啡120杯，每杯80元，總共9600元，全部現金收款。
店租15000元，已付現金。
薪水收入35000元，本月正職薪資，已入帳。
```

---

### 2. 收入明細表

**功能描述：**
- 顯示所有收入項目的詳細資訊
- 包含 11 個欄位：日期、天氣、來客數、分類、類別、收入內容/說明、單價、數量、收款狀況、小計、客戶記錄/備註
- 支援所有欄位的排序功能（升序/降序/取消排序）
- 顯示總收入金額
- 支援一鍵複製表格內容到剪貼簿（TSV 格式）

**排序功能：**
- 點擊表頭欄位可進行排序
- 第一次點擊：升序（↑）
- 第二次點擊：降序（↓）
- 第三次點擊：取消排序
- 支援的排序類型：日期（時間戳）、文字（字母順序）、數字（數值大小）

**視覺化：**
- 使用 Badge 標籤顯示分類和收款狀況
- 已收款項目顯示綠色標籤，未收款顯示紅色標籤
- 小計金額以綠色粗體顯示
- 總計行突出顯示

---

### 3. 支出明細表

**功能描述：**
- 顯示所有支出項目的詳細資訊
- 包含 8 個欄位：日期、分類、支出分類、類別、支出內容、單價、數量、小計
- 支援所有欄位的排序功能（與收入表相同）
- 顯示總支出金額
- 支援一鍵複製表格內容到剪貼簿（TSV 格式）

**分類系統：**
- **分類**：生意支出、生活支出
- **支出分類**：固定支出、變動支出、額外支出、住、食、衣、行、育、樂、醫療、電信、保險、儲蓄、孝養等

**視覺化：**
- 使用 Badge 標籤顯示分類
- 小計金額以紅色粗體顯示
- 總計行突出顯示

---

### 4. 財務分析與現金流評估

**功能描述：**
- 提供三大帳戶的財務狀況分析：總帳、公帳（營業）、私帳（生活）
- 計算並顯示各帳戶的收支餘額
- 自動判斷財務狀況：收支有餘、接近打平、入不敷出
- 計算營業毛利率（如有營業收支）
- 提供緊急預備金建議（3-6 個月生活支出）

**計算項目：**

1. **總帳分析**
   - 總收入
   - 總支出
   - 淨現金流
   - 財務狀況評估

2. **公帳（營業）分析**（僅在有營業收支時顯示）
   - 營業收入
   - 營業支出
   - 營業淨利
   - 營業成本（原料、包材等變動支出）
   - 毛利
   - 毛利率 = (營業收入 - 營業成本) / 營業收入 × 100%

3. **私帳（生活）分析**
   - 生活收入
   - 生活支出
   - 生活淨收支

4. **緊急預備金建議**
   - 最低建議：3 個月生活支出
   - 理想目標：6 個月生活支出
   - 根據實際生活支出自動計算

**視覺化：**
- 使用圖標和顏色標示財務狀況
- 綠色：收支有餘
- 橙色：接近打平
- 紅色：入不敷出
- 支援複製分析結果到剪貼簿

---

### 5. 財務月報表

**功能描述：**
- 生成標準化的財務月報表格式
- 詳細分類統計各項收入和支出
- 支援營業收支分析（如有營業項目）
- 提供收支總結

**報表內容：**

1. **家庭收入**
   - 工資
   - 非工資（副業、投資等）
   - 家人提供
   - 借款
   - 補助或津貼（低收補助、身障補助）
   - 其他收入
   - 總收入

2. **支出**
   - 基本生活支出：食、衣、住、行、育、樂
   - 其他支出：電信、保險、儲蓄、醫療、孝養、捐款、稅金
   - 貸款支出：信用卡、信貸、房貸、車貸、親友借款、當鋪、互助會、其他貸款
   - 生活支出總計
   - 貸款支出總計
   - 總支出

3. **營業收入**（僅在有營業收支時顯示）
   - 營業額

4. **營業支出**（僅在有營業收支時顯示）
   - 營業固定支出
   - 營業變動支出
   - 店租
   - 水電
   - 進貨
   - 原物料
   - 薪資
   - 行銷廣告
   - 設備
   - 總營業支出

5. **收支總結**
   - 總收入
   - 總支出
   - 淨收支（自動判斷正負並以顏色標示）

**功能特色：**
- 支援複製報表內容到剪貼簿
- 表格格式清晰易讀
- 自動計算各項總計

---

## 🎨 用戶介面功能

### 1. 輸入畫面

**功能描述：**
- 提供大型文字輸入框（最小高度 400px）
- 預設顯示示例文字，方便用戶了解輸入格式
- 輸入框支援多行文字輸入
- 提供「AI智能分析」按鈕
- 按鈕在分析過程中顯示載入狀態

**初始狀態：**
- 應用程式啟動時預設顯示輸入畫面
- 頁面標題：「月收支分析工具」
- 說明文字：「使用AI智能辨識收入支出，自動生成財務分析報表」

---

### 2. AI 分析讀取畫面

**功能描述：**
- 在點擊「AI智能分析」後顯示
- 模擬 10 秒的分析過程
- 提供視覺化的進度指示

**視覺元素：**
- 中央顯示 AI 大腦圖標（帶有脈衝動畫）
- 外圈旋轉載入動畫
- 標題：「AI智能分析中」
- 分析步驟提示：
  - 識別收入項目（藍色圖標）
  - 分析支出結構（綠色圖標）
  - 計算財務指標（紫色圖標）
- 進度條動畫（10 秒內從 0% 增長到 100%）
- 預計完成時間提示

---

### 3. 分析結果頁面

**功能描述：**
- 分析完成後自動跳轉到結果頁面
- 提供「返回輸入畫面」按鈕
- 使用分頁（Tabs）組織不同類型的分析結果

**分頁結構：**
1. **收入明細** - 顯示收入明細表
2. **支出明細** - 顯示支出明細表
3. **財務分析** - 顯示現金流分析
4. **財務月報** - 顯示財務月報表

**頁面標題：**
- 主標題：「分析結果」
- 副標題：「AI已完成您的收支分析，以下是詳細結果」

---

## 🔧 技術功能

### 1. 資料結構

**收入資料結構（Income）：**
```typescript
{
  date: string              // 日期
  weather?: string          // 天氣（可選）
  customerCount?: number    // 來客數（可選）
  category: string          // 分類（生意收入/生活收入）
  type: string             // 類別
  description: string      // 收入內容/說明
  unitPrice: number        // 單價
  quantity: number         // 數量
  paymentStatus: string    // 收款狀況
  subtotal: number        // 小計
  customerNote?: string    // 客戶記錄/備註（可選）
}
```

**支出資料結構（Expense）：**
```typescript
{
  date: string             // 日期
  category: string         // 分類（生意支出/生活支出）
  expenseCategory: string  // 支出分類
  type: string            // 類別
  description: string     // 支出內容
  unitPrice: number       // 單價
  quantity: number       // 數量
  subtotal: number       // 小計
}
```

---

### 2. 排序功能

**實現方式：**
- 使用 React useState 管理排序狀態
- 支援三態排序：升序 → 降序 → 取消
- 根據欄位類型自動選擇排序邏輯：
  - 日期：按時間戳排序
  - 文字：按字母順序（不區分大小寫）
  - 數字：按數值大小排序
  - 空值：正確處理空值情況

**視覺指示：**
- 未排序：顯示雙向箭頭圖標（半透明）
- 升序：顯示向上箭頭（↑）
- 降序：顯示向下箭頭（↓）

---

### 3. 複製功能

**實現方式：**
- 使用瀏覽器 Clipboard API
- 將表格資料轉換為 TSV（Tab-Separated Values）格式
- 包含表頭和所有資料行
- 自動添加總計行
- 複製成功後顯示確認提示（2 秒）

**支援的複製功能：**
- 收入明細表複製
- 支出明細表複製
- 財務分析結果複製
- 財務月報表複製

---

### 4. 響應式設計

**功能描述：**
- 支援桌面和行動裝置
- 使用 Tailwind CSS 響應式類別
- 表格在小螢幕上可橫向滾動
- 卡片佈局自動調整

---

## 📊 資料處理邏輯

### 1. 分類邏輯

**收入分類：**
- **生意收入**：包含「生意」關鍵字的收入項目
- **生活收入**：包含「生活」關鍵字的收入項目

**支出分類：**
- **生意支出**：包含「生意」關鍵字的支出項目
- **生活支出**：包含「生活」關鍵字的支出項目

**支出細分類：**
- 固定支出、變動支出、額外支出
- 住、食、衣、行、育、樂
- 電信、保險、儲蓄、醫療、孝養

---

### 2. 計算邏輯

**總收入計算：**
```
總收入 = Σ(所有收入項目的 subtotal)
```

**總支出計算：**
```
總支出 = Σ(所有支出項目的 subtotal)
```

**淨現金流計算：**
```
淨現金流 = 總收入 - 總支出
```

**毛利率計算：**
```
營業成本 = 生意支出中的變動支出（原料、包材等）
毛利 = 營業收入 - 營業成本
毛利率 = (毛利 / 營業收入) × 100%
```

**緊急預備金計算：**
```
月生活支出 = Σ(生活支出項目的 subtotal)
最低建議 = 月生活支出 × 3
理想目標 = 月生活支出 × 6
```

---

### 3. 財務狀況判斷

**判斷標準：**
- **收支有餘**：淨收支 > 5,000
- **接近打平**：-5,000 ≤ 淨收支 ≤ 5,000
- **入不敷出**：淨收支 < -5,000

---

## 🎯 使用流程

1. **輸入階段**
   - 用戶在文字輸入框中輸入收支資訊
   - 可以使用自然語言描述
   - 點擊「AI智能分析」按鈕

2. **分析階段**
   - 顯示 10 秒的讀取畫面
   - AI 分析文字內容
   - 自動識別和分類收支項目

3. **結果展示階段**
   - 自動跳轉到分析結果頁面
   - 預設顯示「收入明細」分頁
   - 用戶可以切換不同分頁查看結果
   - 可以對表格進行排序
   - 可以複製資料到剪貼簿

4. **返回輸入**
   - 點擊「返回輸入畫面」按鈕
   - 回到輸入頁面，可以輸入新的資料

---

## 🔐 技術架構

### 前端技術
- **框架**：Next.js 16.0.7
- **UI 庫**：React 19.2.1
- **樣式**：Tailwind CSS
- **UI 組件**：shadcn/ui（基於 Radix UI）
- **圖表**：Recharts
- **圖標**：Lucide React
- **語言**：TypeScript

### 後端技術
- **API 框架**：Next.js API Routes
- **AI SDK**：Vercel AI SDK
- **AI 模型**：OpenAI GPT-4o
- **資料驗證**：Zod

### 部署
- **平台**：Vercel
- **構建工具**：Turbopack（Next.js 16）

---

## 📝 注意事項

1. **API 金鑰**：需要配置 OpenAI API 金鑰才能使用 AI 分析功能
2. **資料持久化**：目前資料僅存在於瀏覽器記憶體中，重新整理頁面會丟失
3. **錯誤處理**：如果 API 失敗，系統會使用預設的示例資料進行展示
4. **瀏覽器相容性**：需要支援 Clipboard API 的現代瀏覽器

---

## 🚀 未來擴展方向

1. **資料持久化**：整合資料庫儲存歷史記錄
2. **多月份比較**：支援跨月份財務對比
3. **匯出功能**：支援匯出 Excel、PDF 格式
4. **圖表視覺化**：增加更多圖表類型
5. **預算規劃**：添加預算設定和追蹤功能
6. **提醒功能**：定期收支提醒
7. **多用戶支援**：支援多個帳戶管理

---

## 📞 技術支援

如有任何問題或建議，請參考：
- 遷移指南：`MIGRATION_GUIDE.md`
- 核心模組範例：`CORE_MODULES_EXAMPLE.md`

---

*最後更新：2025年1月*

